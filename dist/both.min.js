/*
 *  both - v0.7.0
 *  detects in real time user interaction type (mouse, touch or keyboard) and switches linked events
 *  https://github.com/idomusha/both
 *
 *  Made by idomusha
 *  Under MIT License
 */
!function(a,b,c,d){"use strict";function e(c){this._name=f,this._defaults=b[f].defaults,this.settings=a.extend({},this._defaults,c),this._debug=this.settings.debug,this._debug&&console.log("defaults",this._defaults),this._debug&&console.log("settings",this.settings),this.init()}var f="both";a.extend(e.prototype,{init:function(){var a=this;a._debug&&console.log("##################### init()"),a.buildCache(),a.types=[],a.touch=!1,a.mouse=!1,a.keyboard=!1,a.handlersData={mouse:[],touch:[],key:[]},a.scroll=!1,a.inputs=["input","select","textarea"],a.keys={9:"tab",13:"enter",16:"shift",27:"esc",32:"space",33:"page up",34:"page down",35:"end",36:"home",37:"left arrow",38:"up arrow",39:"right arrow",40:"down arrow"},a.active={type:"",input:""},a.all={type:[],keys:[]},a._debug&&console.log("touch screen:",a.settings.touch),a.settings.touch?a.set("touch",!0):a.set("mouse",!0),a.bindEvents()},destroy:function(){var a=this;a.unbindEvents(),a.window.removeData()},buildCache:function(){this.document=a(c),this.$html=a("html")},bindEvents:function(){var a=this;a._debug&&console.log("##################### bindUIActions()");var b;a.document.on("mousemove."+a._name,function(c){if(a._debug&&console.log(">>> mousemove"),"mouse"!==a.active.type){if(a._debug&&console.log("_touchstart",b),b)return void(b=!1);if(a.scroll&"keyboard"===a.active.type)return void(a.scroll=!1);a.set.call(a,"mouse",c),a.handleInteractionTypeChange(c)}}),a.document.on("touchstart."+a._name,function(c){a._debug&&console.log(">>> touchstart"),b=!0,"touch"!==a.active.type&&(a.set("touch",c),a.handleInteractionTypeChange(c))}),a.document.on("keydown."+a._name,function(b){a.check.call(a,b)})},unbindEvents:function(){var a=this;a.document.off("mousemove."+a._name),a.document.off("touchstart."+a._name)},check:function(a){var b=this;if(b._debug&&console.log("##################### check()",a),b._debug&&console.log("event.type:",a.type),b._debug&&console.log("key:",b._key(a),b.keys[b._key(a)]),b._debug&&console.log("accessible key:",b.keys.hasOwnProperty(b._key(a))),b.keys.hasOwnProperty(b._key(a))){if("tab"!==b.keys[b._key(a)]&&b.inputs.indexOf(b._target(a).nodeName.toLowerCase())>=0)return void(b._debug&&console.log("| ignore navigation keys typing on form element"));if(b._debug&&console.log("| this pressed key causes an event mousemove"),b.scroll=!0,"keyboard"===b.active.type)return;b.set("keyboard",a),b.handleInteractionTypeChange(a)}},set:function(b,c){var e=this;if(e._debug&&console.log("##################### set()",b),"mouse"==b)e.keyboard=!1,e.touch=!1,e.mouse=!0,e._array.remove(e.types,"keyboard"),e._array.remove(e.types,"touch"),e._array.add(e.types,"mouse");else if("touch"==b)e.keyboard=!1,e.touch=!0,e.mouse=!1,e._array.remove(e.types,"keyboard"),e._array.remove(e.types,"mouse"),e._array.add(e.types,"touch");else if("keyboard"==b){if("keyboard"===e.active.type)return;e.mouse=!1,e.touch=!1,e.keyboard=!0,e._array.remove(e.types,"mouse"),e._array.remove(e.types,"touch"),e._array.add(e.types,"keyboard")}if(e.active.type=b,e._debug&&console.log("types:",e.types),e._debug&&console.log("inputs:",e.active.input),e._debug&&console.log("keys:",e.active.key),e.settings["class"])if(e.settings.name){if(e.$html.attr("class")!==d){var f=e.$html.attr("class").split(" ").filter(function(a){return 0!==a.lastIndexOf(e.settings.name,0)});e.$html.attr("class",a.trim(f.join(" ")))}e.$html.addClass(e.settings.name+"-"+e.active.type)}else a("html").removeClass("mouse touch keyboard"),e.$html.addClass(e.active.type);else e.settings.name?e.$html.attr("data-"+e.settings.name,e.active.type):e.$html.attr("data-"+e.defaults.name,e.active.type)},_key:function(a){return a.keyCode?a.keyCode:a.which},_target:function(a){return a.target||a.srcElement},_log:{keys:function(a){-1===this.active.keys.indexOf(this.keys[a])&&this.keys[a]&&this.active.keys.push(this.keys[a])}},_unlog:{keys:function(a){var b=key(a),c=this.active.keys.indexOf(this.keys[b]);-1!==c&&this.active.keys.splice(c,1)}},start:function(){this.handleInteractionTypeChange(!0)},handleInteractionTypeChange:function(a){var b=this,c="boolean"==typeof a&&a?"is setted":"has changed";b._debug&&console.log("---------------------------------------------------"),b._debug&&console.log("Interaction type "+c+": "+b.types.toString()),b._debug&&console.log("---------------------------------------------------"),b["switch"]()},store:function(a,b,c,d){var e=this;e._debug&&console.log("##################### store()"),e._debug&&console.log("- context",a),e._debug&&console.log("- selector",b),e._debug&&console.log("- event",c),e._debug&&console.log("- handler",d),e._array.add(e.handlersData[a],{selector:b,event:c,handler:d}),e._debug&&console.log("handlersData",e.handlersData),null!=e.interval&&clearInterval(this.interval),e.timer=0,e.interval=setInterval(function(){1==e.timer&&(e.start.call(e),clearInterval(e.interval),e.interval=null),e.timer++}.bind(e),100)},lose:function(a,b,c){var d=this;d._debug&&console.log("##################### lose()"),d._debug&&console.log("- context",a),d._debug&&console.log("- selector",b.selector),d._debug&&console.log("- event",c);for(var e=0;e<d.handlersData[a].length;e++)d.handlersData[a][e].selector.selector===b.selector&&d.handlersData[a][e].event===c&&(d.handlersData[a][e].selector.off(d.handlersData[a][e].event,d.handlersData[a][e].handler),d._array.remove(d.handlersData[a],d.handlersData[a][e]),e--)},"switch":function(){var a=this;a._debug&&console.log("##################### switch()");var b={on:a.types.indexOf("mouse")>-1?"mouse":"touch",off:a.types.indexOf("mouse")>-1?"touch":"mouse"};a._debug&&console.log(a.types),a.on(b.on),a.off(b.off)},on:function(a){var b=this;b._debug&&console.log("##################### on()");for(var c=0;c<b.handlersData[a].length;c++){var d={selector:b.handlersData[a][c].selector,event:b.handlersData[a][c].event,handler:b.handlersData[a][c].handler};d.selector.on(d.event,d.handler)}},off:function(a){var b=this;b._debug&&console.log("##################### off()");for(var c=0;c<b.handlersData[a].length;c++){var d={selector:b.handlersData[a][c].selector,event:b.handlersData[a][c].event,handler:b.handlersData[a][c].handler};d.selector.off(d.event,d.handler)}},_array:{add:function(a,b){this._debug&&console.log("##################### array.add()"),a.push(b)},remove:function(a,b){this._debug&&console.log("##################### array.remove()");var c=a.indexOf(b);c>-1&&a.splice(c,1)}},refresh:function(){this._debug&&console.log("##################### refresh()")},getType:function(){return _this._debug&&console.log(this),this.active.type},getKey:function(){return this.active.input},getTypes:function(){return this.types}}),b[f]=function(c){a.data(b,f)||a.data(b,f,new e(c))},b[f].defaults={touch:!1,name:"interaction","class":!1,debug:!1}}(jQuery,window,document);